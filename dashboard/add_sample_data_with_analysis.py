"""
詳細な決算分析付きのサンプルPTSデータを追加
"""
from models import save_pts_data
from datetime import datetime

# サンプルの銘柄データ（決算発表銘柄）
sample_stocks = [
    {
        'code': '6072',
        'name': '地盤ネットホールディングス',
        'pts_price': 328.0,
        'change_rate': 32.3,
        'change_amount': 80,
        'volume': 14900,
        'market': '東証S'
    },
    {
        'code': '4063',
        'name': '信越化学工業',
        'pts_price': 5240,
        'change_rate': 8.5,
        'change_amount': 410,
        'volume': 45000,
        'market': '東証P'
    },
    {
        'code': '7203',
        'name': 'トヨタ自動車',
        'pts_price': 2890,
        'change_rate': 6.8,
        'change_amount': 184,
        'volume': 250000,
        'market': '東証P'
    },
]

# 銘柄ごとの詳細ニュースと決算分析
stock_data = {
    '6072': {
        'news': [
            {'title': '【決算】主要株主の異動により大株主にKaihou社が浮上、持株比率20%超え', 'date': '2026/02/10 14:24'},
            {'title': '【材料】地盤ＨＤはＳ高カイ気配、井村俊哉氏が代表の「Ｋａｉｈｏｕ」大株主浮上', 'date': '2026/02/10 14:24'},
            {'title': '【テク】地盤ネットHD---気配値で既にストップ高', 'date': '2026/02/10 08:54'},
        ],
        'company': {
            'market': '東証スタンダード',
            'industry': 'サービス業',
            'market_cap': '57.4億円'
        },
        'analysis': {
            'main_reason': '地盤ネットホールディングスは前日比+32.3%の大幅高となった。主な上昇要因は大株主の異動。具体的には、井村俊哉氏が代表を務める「Kaihou」社が大株主として浮上し、持株比率が20%を超えたことが材料視された。市場では今後の経営戦略の変化や事業拡大への期待が高まっている。',
            'earnings_detail': {
                'earnings_reason': '主要株主の異動が発表され、井村俊哉氏率いるKaihou社が筆頭株主として浮上。持株比率が20%を超えることで、経営への関与強化が見込まれる。井村氏は過去に複数の企業再生を手掛けた実績があり、地盤ネット社の事業拡大や収益改善への期待が高まっている。',
                'key_factors': [
                    '井村俊哉氏率いるKaihou社が大株主として参画（持株比率20%超）',
                    '井村氏の企業再生・成長支援の実績が評価される',
                    '経営戦略の見直しや新規事業展開への期待感'
                ],
                'outlook': '新大株主の参画により、地盤調査事業の拡大や新規事業への投資が期待される。井村氏の経営ノウハウを活かした事業再構築により、中長期的な業績向上の可能性がある。ただし、短期的には株価が急騰したため、調整局面に入る可能性もあり注意が必要。'
            },
            'future_potential': '中立的な見方。理由：短期的な過熱感あり。ただし、急騰後のため短期的な調整リスクに注意。'
        }
    },
    '4063': {
        'news': [
            {'title': '【決算】2025年3月期第3四半期決算を発表、営業利益が前年同期比28%増の2,150億円', 'date': '2026/02/10 15:30'},
            {'title': '【材料】半導体材料の需要急増、四半期売上高が過去最高を更新', 'date': '2026/02/10 15:30'},
            {'title': '【材料】米国大手半導体メーカーとの長期供給契約を締結', 'date': '2026/02/10 14:00'},
        ],
        'company': {
            'market': '東証プライム',
            'industry': '化学',
            'market_cap': '8兆5,000億円'
        },
        'analysis': {
            'main_reason': '信越化学工業は前日比+8.5%の大幅高となった。主な上昇要因は好決算。具体的には、2025年3月期第3四半期決算で営業利益が前年同期比28%増の2,150億円と大幅増益を達成。半導体材料の需要急増により売上高も過去最高を更新した。市場では好調、増加と評価されている。',
            'earnings_detail': {
                'earnings_reason': '第3四半期の営業利益が前年同期比28%増の2,150億円と大幅増益を達成。売上高も前年同期比18%増の1兆2,800億円と過去最高を更新した。主力の半導体シリコンウエハー事業が好調で、生成AI向けや自動車向けの需要が急拡大。塩ビ事業も北米市場で価格転嫁が進み、増益に寄与した。',
                'key_factors': [
                    '半導体シリコンウエハー事業が好調（生成AI、自動車向け需要急増）',
                    '塩ビ事業で北米市場での価格転嫁が成功し利益率が改善',
                    '米国大手半導体メーカーとの長期供給契約締結により受注残が増加'
                ],
                'outlook': '生成AI向けの半導体需要は今後も堅調に推移すると見込まれ、同社の主力製品であるシリコンウエハーの需要拡大が継続する見通し。長期供給契約により安定した受注が確保されており、2025年度通期では過去最高益の更新が濃厚。株価は既に上昇しているが、業績の伸びを考慮すると中長期的には更なる上値余地がある。'
            },
            'future_potential': '将来性は非常に高いと評価される。理由：業績好調, 新技術・新製品による成長期待, 適度な上昇。'
        }
    },
    '7203': {
        'news': [
            {'title': '【決算】2025年3月期業績予想を上方修正、営業利益を従来予想から10%引き上げ', 'date': '2026/02/10 15:00'},
            {'title': '【材料】次世代EV電池の開発成功を発表、航続距離1000km実現', 'date': '2026/02/10 15:00'},
            {'title': '【材料】北米市場でのEV販売台数が前年比150%増', 'date': '2026/02/10 14:30'},
        ],
        'company': {
            'market': '東証プライム',
            'industry': '輸送用機器',
            'market_cap': '58兆6,626億円'
        },
        'analysis': {
            'main_reason': 'トヨタ自動車は前日比+6.8%上昇。主な上昇要因は業績予想の上方修正。具体的には、2025年3月期の営業利益予想を従来の4.5兆円から5.0兆円へと10%引き上げた。次世代EV電池の開発成功により航続距離1,000kmを実現し、EV市場での競争力強化が評価された。市場では好調、成長、期待と評価されている。',
            'earnings_detail': {
                'earnings_reason': '2025年3月期の営業利益予想を従来の4.5兆円から5.0兆円へと10%上方修正。北米市場でのハイブリッド車とEVの販売が好調で、特にEV販売台数が前年比150%増と急拡大。全固体電池を搭載した次世代EV電池の開発に成功し、航続距離1,000kmを実現したことで、EV市場での競争力が大幅に向上した。',
                'key_factors': [
                    '営業利益予想を10%上方修正（4.5兆円→5.0兆円）',
                    '次世代EV電池の開発成功により航続距離1,000kmを実現',
                    '北米市場でのEV販売台数が前年比150%増と急拡大'
                ],
                'outlook': '全固体電池の実用化により、EV市場での競争力が大幅に向上する見通し。2027年からの量産開始が予定されており、中長期的な成長ドライバーとなる。ハイブリッド車も引き続き好調で、世界的な環境規制強化を追い風に販売拡大が期待される。今期は過去最高益を更新する見込みで、来期以降も増益基調が続くと予想される。'
            },
            'future_potential': '将来性は非常に高いと評価される。理由：業績好調, 新技術・新製品による成長期待, 事業拡大, 適度な上昇。'
        }
    }
}

print("📊 詳細な決算分析付きサンプルデータを追加中...\n")

# 同じタイムスタンプで保存
timestamp = datetime.now().isoformat()

for stock in sample_stocks:
    code = stock['code']
    data = stock_data[code]

    save_pts_data(
        stock,
        data['news'],
        data['company'],
        timestamp,
        data['analysis']
    )

    print(f"✅ {code} {stock['name']}")
    print(f"   変化率: {stock['change_rate']:+.1f}%")
    print(f"   上昇理由: {data['analysis']['main_reason'][:60]}...")
    if data['analysis']['earnings_detail']:
        print(f"   決算分析: {data['analysis']['earnings_detail']['earnings_reason'][:60]}...")
    print()

print("🎉 完了！ダッシュボードをリロードしてください")
print("   http://localhost:5001")
print("\n💡 「詳細」ボタンをクリックすると、Claude API風の詳細な決算分析が表示されます")
